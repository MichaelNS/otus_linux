# Выпускной проект курса "Administrator Linux. Professional"

Исходное задание:
Создание рабочего веб-проекта с развертыванием нескольких виртуальных машин.

Отвечает следующим требованиям:
- включен https
- основная инфраструктура в DMZ зоне
- файрвалл на входе
- сбор метрик и настроенный алертинг
- везде включен selinux
- организован централизованный сбор логов
- организован backup базы

# Тема: Развертывание инфраструктуры для веб-портала с помощью ansible

Проект представляет собой сеть из пяти серверов:


![Иллюстрация к проекту](linux_project.drawio.png)

Сервисы на машинах поднимаются с помощью Ansible.

- **Bastion server** - маршрутизатор-файрволл на входе сети
- **Web server** - сервер с фронтэндом и бэкэндом
- **Mysql server** - сервер баз данных
- **Backup server** - сервер для бэкапов и сбора логов
- **Monitor server** - сервер мониторинга

Основные компонеты ВМ:

## Общие для всех ВМ

На каждой машине добавляется репозиторий `epel-release`.

Также устанавливается prometheus-node-exporter-агент.

## ВМ wordpressServer
Здесь устанавливаются:
- php-fpm
- nginx
- wordpress
- Клиент rsyslog

Nginx перенаправляет запросы с 80 на 443 порт для безопасного соединения.
С php-fpm общается через unix-сокет, чтобы избежать затрат на tcp.


## ВМ mysqlServer
Здесь устанавливаются:
- mariadb
- Клиент rsyslog

На этом серевере БД размещена БД Wordpress.

С базы делается бекап mysqldump и borgbackup, вызываемые по таймеру systemd.

## ВМ inetRouter
Здесь решается задача передачи пакетов между портами и настраивается `iptables`: настроен проброс портов до nginx, весь остальной трафик из интернета дропается.

## ВМ backupsServer
Здесь устанавливается:
- borgbackup server
- rsyslog server


## ВМ monitorServer
Здесь устанавливается:
- prometeus server
- Grafana

Дефолтные учетные данные: `admin/admin`

## Развертывание стенда
### Подготовка стенда
Установка ролей

./init-base.sh

Готовим ключ. Копируем его в подкаталог ./provision/ssh
```bash
ssh-keygen -t rsa -f ~/.ssh/vagrant-key

cat ~/.ssh/vagrant-key.pub > ./files/authorized_keys
```

### Запуск стенда
```bash
./setup.sh

./play.sh
```

#### Пересоздание стенда
```bash
./destroy.sh && ./setup.sh && ./play.sh

```

